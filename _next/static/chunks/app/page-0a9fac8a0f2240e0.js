(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{94:(e,t,l)=>{"use strict";l.d(t,{A:()=>i});var r=l(5155),a=l(7909),n=l(2115);let s=(0,a.default)(()=>Promise.all([l.e(761),l.e(893)]).then(l.bind(l,6893)),{loadableGenerated:{webpack:()=>[6893]},ssr:!1}),i=(0,n.memo)(function(e){let{polyline:t,height:l=320,center:a,zoom:i=13}=e,o=(0,n.useMemo)(()=>{if(a)return a;if(t&&t.length>0){let e=t[0];return[e[0],e[1]]}return[39.905,-75.353]},[a,t]),u=(0,n.useMemo)(()=>{if(!t||0===t.length)return;let e=1/0,l=1/0,r=-1/0,a=-1/0;for(let n of t){let[t,s]=n;Number.isFinite(t)&&Number.isFinite(s)&&(t<e&&(e=t),s<l&&(l=s),t>r&&(r=t),s>a&&(a=s))}if(Number.isFinite(e)&&Number.isFinite(l)&&Number.isFinite(r)&&Number.isFinite(a))return[[e,l],[r,a]]},[t]);return(0,r.jsx)(s,{polyline:t,height:l,center:o,zoom:i,bounds:u})})},849:(e,t,l)=>{"use strict";l.d(t,{A:()=>m});var r=l(5155),a=l(4466),n=l(1751),s=l(6411),i=l(2909),o=l(8230),u=l(3272),c=l(2115);let h=[{key:"traffic",label:"Traffic"},{key:"elevation",label:"Elevation"},{key:"scenic",label:"Scenic"},{key:"surface",label:"Surface"},{key:"safety",label:"Safety"},{key:"access",label:"Access"}],m=(0,c.memo)(function(e){let{ratings:t,size:l=280}=e,c=h.map(e=>{var l;let{key:r,label:a}=e;return{label:a,value:Math.max(0,Math.min(10,null!=(l=t[r])?l:0))}});return(0,r.jsx)("div",{style:{width:l,height:l},children:(0,r.jsx)(a.u,{width:"100%",height:"100%",children:(0,r.jsxs)(n.V,{data:c,outerRadius:"80%",children:[(0,r.jsx)(s.z,{gridType:"polygon"}),(0,r.jsx)(i.r,{dataKey:"label",tick:{fontSize:12}}),(0,r.jsx)(o.E,{angle:30,domain:[0,10],tickCount:6}),(0,r.jsx)(u.V,{dataKey:"value",stroke:"#2563eb",fill:"#60a5fa",fillOpacity:.45})]})})})})},964:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>f});var r=l(5155),a=l(2115),n=l(2619),s=l.n(n),i=l(94),o=l(5880),u=l.n(o),c=l(4126);let h=(0,a.memo)(function(e){let{file:t}=e,[l,n]=(0,a.useState)(null);(0,a.useEffect)(()=>{let e=!1;return(async()=>{var l,r;if(!t)return n(null);let a=await t.text(),s=new(u());s.parse(a);let i=null==(l=s.tracks)?void 0:l[0],o=(null!=(r=null==i?void 0:i.points)?r:[]).map(e=>[e.lat,e.lon]),h=(0,c.u)(o);if(!e){let e=h.length>0?h[0]:[39.905,-75.353];n({polyline:h,center:e})}})(),()=>{e=!0}},[t]);let s=(0,a.useMemo)(()=>l?function(e){let t=e=>e*Math.PI/180,l=0;for(let r=1;r<e.length;r++){let[a,n]=e[r-1],[s,i]=e[r],o=t(s-a),u=t(i-n),c=Math.sin(o/2)*Math.sin(o/2)+Math.cos(t(a))*Math.cos(t(s))*Math.sin(u/2)*Math.sin(u/2);l+=2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c))*6371e3}let r=l/1609.344;return{meters:l,miles:r}}(l.polyline):null,[l]);return l?(0,r.jsxs)("div",{style:{display:"grid",gap:8},children:[(0,r.jsx)(i.A,{polyline:l.polyline,center:l.center,height:360}),s?(0,r.jsxs)("div",{style:{fontSize:13},children:["Distance: ",s.miles.toFixed(2)," mi (",Math.round(s.meters)," m)"]}):null]}):null});var m=l(849),p=l(8056),d=l(5704);let g=["traffic","elevation","scenic","surface","safety","access"];function f(){let[e,t]=(0,a.useState)(void 0),[l,n]=(0,a.useState)(""),[i,o]=(0,a.useState)(""),[u,f]=(0,a.useState)(""),[y,x]=(0,a.useState)(!1),[b,v]=(0,a.useState)({open:!1,message:"",severity:"success"}),[S,N]=(0,a.useState)({traffic:5,elevation:5,scenic:5,surface:5,safety:5,access:5}),[w,k]=(0,a.useState)(!1),M=(0,a.useRef)(null);return(0,a.useEffect)(()=>{var e,t;let l="seededRoutesV1",r=localStorage.getItem(l),a=(0,p.aB)();if(r||a&&a.length>0)return;let n=d.env.NEXT_PUBLIC_BASE_PATH||"",s=(null==(t=globalThis)||null==(e=t.__NEXT_DATA__)?void 0:e.assetPrefix)||"",i=n||s||"",o=[{path:"".concat(i,"/Afternoon_Run.gpx"),title:"Afternoon Run",author:"Seed"},{path:"".concat(i,"/Morning_Run.gpx"),title:"Morning Run",author:"Seed"}];(async()=>{try{for(let e of o){let t=await fetch(e.path);if(!t.ok)continue;let l=await t.text(),{polyline:r,distanceMeters:a,elevationGainMeters:n}=(0,c.U)(l);(0,p.Fq)({title:e.title,author:e.author,description:void 0,gpxText:l,polyline:JSON.stringify(r),distanceMeters:a,elevationGainMeters:n,traffic:5,elevation:5,scenic:5,surface:5,safety:5,access:5})}localStorage.setItem(l,"1")}catch(e){}})()},[]),(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-6xl",children:[(0,r.jsx)("h1",{className:"text-4xl font-bold mb-2 text-gray-800",children:"Swarthmore XC Routes"}),(0,r.jsx)("p",{className:"text-gray-600 mb-8",children:"Upload a GPX file and rate the route across six qualities."}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,r.jsxs)("div",{className:"rounded-xl border border-gray-200 bg-white shadow-sm p-5",children:[(0,r.jsx)("input",{type:"text",placeholder:"Route Title",value:l,onChange:e=>n(e.target.value),className:"w-full p-3 mb-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,r.jsx)("input",{type:"text",placeholder:"Author Name",value:i,onChange:e=>o(e.target.value),className:"w-full p-3 mb-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,r.jsxs)("div",{role:"button",tabIndex:0,onKeyDown:e=>{var t;("Enter"===e.key||" "===e.key)&&(null==(t=M.current)||t.click())},onClick:()=>{var e;return null==(e=M.current)?void 0:e.click()},onDragOver:e=>{e.preventDefault(),k(!0)},onDragLeave:e=>{e.preventDefault(),k(!1)},onDrop:e=>{var l;e.preventDefault(),k(!1);let r=null==(l=e.dataTransfer.files)?void 0:l[0];r&&t(r)},className:"border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-colors ".concat(w?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"),children:[(0,r.jsxs)("svg",{className:"w-9 h-9 mb-2 text-gray-500",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,r.jsx)("path",{d:"M3 7.5A2.5 2.5 0 0 1 5.5 5H9l2 2h7.5A2.5 2.5 0 0 1 21 9.5v8A2.5 2.5 0 0 1 18.5 20h-13A2.5 2.5 0 0 1 3 17.5v-10Z",stroke:"currentColor",strokeWidth:"1.5"}),(0,r.jsx)("path",{d:"M12 15.5v-6m0 0 2.5 2.5M12 9.5 9.5 12",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),(0,r.jsx)("p",{className:"text-gray-600",children:"Drag and drop GPX here, or click to browse"}),(0,r.jsx)("input",{ref:M,hidden:!0,type:"file",accept:".gpx,application/gpx+xml",onChange:e=>{var l,r;return t(null!=(r=null==(l=e.target.files)?void 0:l[0])?r:void 0)}})]}),(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)(h,{file:e})})]}),(0,r.jsxs)("div",{className:"rounded-xl border border-gray-200 bg-white shadow-sm p-5",children:[(0,r.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-gray-800",children:"Ratings"}),(0,r.jsx)("textarea",{placeholder:"Description (optional)",value:u,onChange:e=>f(e.target.value),rows:3,className:"w-full p-3 mb-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,r.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:g.map(e=>(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2 capitalize",children:[e,": ",S[e]]}),(0,r.jsx)("input",{type:"range",min:"0",max:"10",step:"1",value:S[e],onChange:t=>N(l=>({...l,[e]:parseInt(t.target.value)})),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"})]},e))}),(0,r.jsx)("div",{className:"mt-6 flex justify-center",children:(0,r.jsx)(m.A,{ratings:S})})]})]}),(0,r.jsxs)("div",{className:"flex gap-4 mt-8",children:[(0,r.jsx)("button",{disabled:!e||!l||!i,onClick:async()=>{if(!e)return;x(!0);let r=await e.text(),{polyline:a,distanceMeters:s,elevationGainMeters:h}=(0,c.U)(r);try{(0,p.Fq)({title:l,author:i,description:u||void 0,gpxText:r,polyline:JSON.stringify(a),distanceMeters:s,elevationGainMeters:h,traffic:S.traffic,elevation:S.elevation,scenic:S.scenic,surface:S.surface,safety:S.safety,access:S.access}),v({open:!0,message:"Route saved!",severity:"success"}),n(""),o(""),f(""),t(void 0)}catch(e){v({open:!0,message:"Save failed",severity:"error"})}finally{x(!1)}},className:"px-6 py-3 rounded-lg font-medium transition-colors ".concat(e&&l&&i?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:y?"Saving...":"Save Route"}),(0,r.jsx)(s(),{href:"/routes",className:"px-6 py-3 border border-gray-300 rounded-lg font-medium text-gray-700 hover:bg-gray-50 transition-colors",children:"View All Routes"})]}),b.open&&(0,r.jsxs)("div",{className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-lg text-white font-medium ".concat("success"===b.severity?"bg-green-600":"bg-red-600"),children:[b.message,(0,r.jsx)("button",{onClick:()=>v(e=>({...e,open:!1})),className:"ml-4 text-white hover:text-gray-200",children:"\xd7"})]})]})}},2568:e=>{e.exports=function(){return t};function t(){}},4126:(e,t,l)=>{"use strict";function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;if(e.length<=t)return e;let l=Math.floor((e.length-2)/(t-2)),r=[e[0]];for(let t=l;t<e.length-1;t+=l)r.push(e[t]);return r.push(e[e.length-1]),r}function a(e){let t=new DOMParser().parseFromString(e,"application/xml"),l=Array.from(t.getElementsByTagName("trkpt"));if(0===l.length)try{l=Array.from(t.getElementsByTagNameNS("*","trkpt"))}catch(e){}0===l.length&&(l=Array.from(t.querySelectorAll("[lat][lon]")));let a=l.map(e=>[Number(e.getAttribute("lat")),Number(e.getAttribute("lon")),Number(e.getAttribute("ele"))]).filter(e=>{let[t,l]=e;return Number.isFinite(t)&&Number.isFinite(l)}),n=e=>e*Math.PI/180,s=0,i=0;for(let e=1;e<a.length;e++){let[t,l,r]=a[e-1],[o,u,c]=a[e],h=n(o-t),m=n(u-l),p=Math.sin(h/2)**2+Math.cos(n(t))*Math.cos(n(o))*Math.sin(m/2)**2;if(s+=2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p))*6371e3,Number.isFinite(r)&&Number.isFinite(c)){let e=c-r;e>0&&(i+=e)}}let o=r(a.map(e=>{let[t,l]=e;return[t,l]})),u=o.length>0?o[0]:[39.905,-75.353];return{polyline:o,center:u,distanceMeters:s,elevationGainMeters:i}}l.d(t,{U:()=>a,u:()=>r})},5880:(e,t,l)=>{let r=function(){this.xmlSource="",this.metadata={},this.waypoints=[],this.tracks=[],this.routes=[]};r.prototype.parse=function(e){let t=new window.DOMParser;this.xmlSource=t.parseFromString(e,"text/xml");let l=this.xmlSource.querySelector("metadata");if(null!=l){this.metadata.name=this.getElementValue(l,"name"),this.metadata.desc=this.getElementValue(l,"desc"),this.metadata.time=this.getElementValue(l,"time");let e={},t=l.querySelector("author");if(null!=t){e.name=this.getElementValue(t,"name"),e.email={};let l=t.querySelector("email");null!=l&&(e.email.id=l.getAttribute("id"),e.email.domain=l.getAttribute("domain"));let r={},a=t.querySelector("link");null!=a&&(r.href=a.getAttribute("href"),r.text=this.getElementValue(a,"text"),r.type=this.getElementValue(a,"type")),e.link=r}this.metadata.author=e;let r={},a=this.queryDirectSelector(l,"link");null!=a&&(r.href=a.getAttribute("href"),r.text=this.getElementValue(a,"text"),r.type=this.getElementValue(a,"type"),this.metadata.link=r)}var r=[].slice.call(this.xmlSource.querySelectorAll("wpt"));for(let e in r){var a=r[e];let t={};t.name=this.getElementValue(a,"name"),t.sym=this.getElementValue(a,"sym"),t.lat=parseFloat(a.getAttribute("lat")),t.lon=parseFloat(a.getAttribute("lon"));let l=parseFloat(this.getElementValue(a,"ele"));t.ele=isNaN(l)?null:l,t.cmt=this.getElementValue(a,"cmt"),t.desc=this.getElementValue(a,"desc");let n=this.getElementValue(a,"time");t.time=null==n?null:new Date(n),this.waypoints.push(t)}var n=[].slice.call(this.xmlSource.querySelectorAll("rte"));for(let e in n){let t=n[e],l={};l.name=this.getElementValue(t,"name"),l.cmt=this.getElementValue(t,"cmt"),l.desc=this.getElementValue(t,"desc"),l.src=this.getElementValue(t,"src"),l.number=this.getElementValue(t,"number");let r=this.queryDirectSelector(t,"type");l.type=null!=r?r.innerHTML:null;let a={},i=t.querySelector("link");null!=i&&(a.href=i.getAttribute("href"),a.text=this.getElementValue(i,"text"),a.type=this.getElementValue(i,"type")),l.link=a;let o=[];var s=[].slice.call(t.querySelectorAll("rtept"));for(let e in s){let t=s[e],l={};l.lat=parseFloat(t.getAttribute("lat")),l.lon=parseFloat(t.getAttribute("lon"));let r=parseFloat(this.getElementValue(t,"ele"));l.ele=isNaN(r)?null:r;let a=this.getElementValue(t,"time");l.time=null==a?null:new Date(a),o.push(l)}l.distance=this.calculDistance(o),l.elevation=this.calcElevation(o),l.slopes=this.calculSlope(o,l.distance.cumul),l.points=o,this.routes.push(l)}var i=[].slice.call(this.xmlSource.querySelectorAll("trk"));for(let e in i){let t=i[e],l={};l.name=this.getElementValue(t,"name"),l.cmt=this.getElementValue(t,"cmt"),l.desc=this.getElementValue(t,"desc"),l.src=this.getElementValue(t,"src"),l.number=this.getElementValue(t,"number");let r=this.queryDirectSelector(t,"type");l.type=null!=r?r.innerHTML:null;let a={},n=t.querySelector("link");null!=n&&(a.href=n.getAttribute("href"),a.text=this.getElementValue(n,"text"),a.type=this.getElementValue(n,"type")),l.link=a;let s=[],u=[].slice.call(t.querySelectorAll("trkpt"));for(let e in u){var o=u[e];let t={};t.lat=parseFloat(o.getAttribute("lat")),t.lon=parseFloat(o.getAttribute("lon"));let l=parseFloat(this.getElementValue(o,"ele"));t.ele=isNaN(l)?null:l;let r=this.getElementValue(o,"time");t.time=null==r?null:new Date(r),s.push(t)}l.distance=this.calculDistance(s),l.elevation=this.calcElevation(s),l.slopes=this.calculSlope(s,l.distance.cumul),l.points=s,this.tracks.push(l)}},r.prototype.getElementValue=function(e,t){let l=e.querySelector(t);return null!=l?null!=l.innerHTML?l.innerHTML:l.childNodes[0].data:l},r.prototype.queryDirectSelector=function(e,t){let l=e.querySelectorAll(t),r=l[0];if(l.length>1){let l=e.childNodes;for(idx in l)(elem=l[idx]).tagName===t&&(r=elem)}return r},r.prototype.calculDistance=function(e){let t={},l=0,r=[];for(var a=0;a<e.length-1;a++)l+=this.calcDistanceBetween(e[a],e[a+1]),r[a]=l;return r[e.length-1]=l,t.total=l,t.cumul=r,t},r.prototype.calcDistanceBetween=function(e,t){let l={};l.lat=e.lat,l.lon=e.lon;let r={};r.lat=t.lat,r.lon=t.lon;var a=Math.PI/180,n=l.lat*a,s=r.lat*a,i=Math.sin((r.lat-l.lat)*a/2),o=Math.sin((r.lon-l.lon)*a/2),u=i*i+Math.cos(n)*Math.cos(s)*o*o;return 2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u))*6371e3},r.prototype.calcElevation=function(e){for(var t=0,l=0,r={},a=0;a<e.length-1;a++){let r=e[a+1].ele,n=e[a].ele;if(null!==r&&null!==n){let e=parseFloat(r)-parseFloat(n);e<0?l+=e:e>0&&(t+=e)}}for(var n=[],s=0,i=(a=0,e.length);a<i;a++)if(null!==e[a].ele){var o=parseFloat(e[a].ele);n.push(o),s+=o}return r.max=Math.max.apply(null,n)||null,r.min=Math.min.apply(null,n)||null,r.pos=Math.abs(t)||null,r.neg=Math.abs(l)||null,r.avg=s/n.length||null,r},r.prototype.calculSlope=function(e,t){let l=[];for(var r=0;r<e.length-1;r++){let a=e[r],n=100*(e[r+1].ele-a.ele)/(t[r+1]-t[r]);l.push(n)}return l},r.prototype.toGeoJSON=function(){var e,t={type:"FeatureCollection",features:[],properties:{name:this.metadata.name,desc:this.metadata.desc,time:this.metadata.time,author:this.metadata.author,link:this.metadata.link}};for(idx in this.tracks){let r=this.tracks[idx];var l={type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{}};for(idx in l.properties.name=r.name,l.properties.cmt=r.cmt,l.properties.desc=r.desc,l.properties.src=r.src,l.properties.number=r.number,l.properties.link=r.link,l.properties.type=r.type,r.points){let t=r.points[idx];(e=[]).push(t.lon),e.push(t.lat),e.push(t.ele),l.geometry.coordinates.push(e)}t.features.push(l)}for(idx in this.routes){let r=this.routes[idx];for(idx in(l={type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{}}).properties.name=r.name,l.properties.cmt=r.cmt,l.properties.desc=r.desc,l.properties.src=r.src,l.properties.number=r.number,l.properties.link=r.link,l.properties.type=r.type,r.points){let t=r.points[idx];(e=[]).push(t.lon),e.push(t.lat),e.push(t.ele),l.geometry.coordinates.push(e)}t.features.push(l)}for(idx in this.waypoints){let e=this.waypoints[idx];(l={type:"Feature",geometry:{type:"Point",coordinates:[]},properties:{}}).properties.name=e.name,l.properties.sym=e.sym,l.properties.cmt=e.cmt,l.properties.desc=e.desc,l.geometry.coordinates=[e.lon,e.lat,e.ele],t.features.push(l)}return t},l(2568)(),e.exports=r},7414:(e,t,l)=>{Promise.resolve().then(l.bind(l,964))},8056:(e,t,l)=>{"use strict";l.d(t,{Fq:()=>s,aB:()=>n,o6:()=>i,z9:()=>o});let r="swat-routes",a="swat-comments";function n(){try{return JSON.parse(localStorage.getItem(r)||"[]")}catch(e){return[]}}function s(e){let t={...e,id:Math.random().toString(36).substr(2,9),createdAt:new Date().toISOString()},l=n();return l.unshift(t),localStorage.setItem(r,JSON.stringify(l)),t}function i(e){try{return JSON.parse(localStorage.getItem(a)||"[]").filter(t=>t.routeId===e).sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime())}catch(e){return[]}}function o(e){let t={...e,id:Math.random().toString(36).substr(2,9),createdAt:new Date().toISOString()},l=JSON.parse(localStorage.getItem(a)||"[]");return l.unshift(t),localStorage.setItem(a,JSON.stringify(l)),t}}},e=>{e.O(0,[856,619,441,255,358],()=>e(e.s=7414)),_N_E=e.O()}]);